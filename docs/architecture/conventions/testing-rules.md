# テスト方針

## 単体テスト方針（古典学派）

- ドメインの振る舞いを最優先でテスト
  - ユースケースの意味やビジネスルールが崩れないことを確認する
  - 実装詳細ではなく入力→出力の振る舞いにフォーカスする
- 本物の依存を使う / 過剰モックしない
  - 可能な限り実際のクラスや値を渡す
  - テストダブルは外部システムなど必要最小限に限定する
- テストコードは短く・簡潔に
  - Arrange/Act/Assert を小さくまとめ、可読性を重視する
  - 重複はヘルパーに切り出し、不要な抽象化は避ける
- 4つの柱を常に満たす
  - 退行防止、リファクタリング耐性、素早いフィードバック、保守のしやすさ
- アンチパターンを避ける
  - プライベート実装の直接テスト・テスト同士の依存・テストのための本体改変は禁止
- シナリオ駆動でテスト名を付ける
  - 「条件→行動→結果」を名前で表現し、失敗時の意図が一目でわかるようにする

## 統合テスト方針（Integration Test）

- 実際の DB を使用する
  - モック DB やインメモリ DB ではなく、本物の DB に接続してテストする
  - 本番環境に近い条件で動作を検証する
- ファイル命名規則
  - 統合テストのファイル名には `.integration.test.ts` を付ける
  - 例: `user-repository.integration.test.ts`
- テスト間のデータ分離
  - 各テストの前後で DB をクリーンアップし、テスト間の依存を排除する
- 共有依存のみモックする
  - 共有依存（外部サービス、メール送信、外部 API など）はモックする
  - それ以外の依存（DB、内部クラスなど）は本物を使う
- 実行速度より正確性を優先
  - 単体テストより遅くなるが、実環境に近い信頼性の高い結果を得る

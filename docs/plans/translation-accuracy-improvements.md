# 翻訳精度向上

更新日: 2026-01-26

---

## 目的

固有名詞の音訳を防ぎ、定訳や意味訳を使用するようにする。

```
現状: Silakkhandhavaggapali → シーラッカンダーヴァッガパリ (音訳 ✗)
目標: Silakkhandhavaggapali → 戒蘊品 (定訳 ✓)
```

---

## 候補アプローチ

### 1. Context-Enriched Translation（コンテキスト強化翻訳）

```
原文 → 要約生成 → 関連情報検索 → コンテキスト統合 → 翻訳
```

- **メリット**: 専門用語の文脈に応じた正確な翻訳
- **デメリット**: API呼び出し回数増加（コスト↑）、処理時間増加

### 2. Glossary-Based Translation（用語集ベース翻訳）

専門用語の対訳表を事前に定義し、翻訳時に強制的に使用。

| Pali | 日本語 |
|------|--------|
| dukkha | 苦 |
| nibbāna | 涅槃 |

- **メリット**: 一貫性が保証される
- **デメリット**: 用語集が正しいか検証が必要、汎用プロジェクトに不向き

### 3. Multi-Pass Translation（多段階翻訳）

```
原文 → 直訳 → 文脈調整 → スタイル調整 → 最終訳
```

- **メリット**: 各パスで品質向上
- **デメリット**: コスト3倍、処理時間3倍

### 4. Reference Corpus Integration（参照コーパス統合）

既存の高品質翻訳（SuttaCentral等）をDB化し、類似セグメントを参照。

- **メリット**: 学術的に検証された訳を参照可能
- **デメリット**: 特定ソース依存で汎用性が下がる

### 5. Translation Memory（翻訳メモリ）

過去に承認された翻訳を再利用。

- **メリット**: 同一セグメントは即時翻訳、コスト削減
- **デメリット**: 初期は空なので効果薄い

### 6. Web検索による定訳取得

タイトルをWeb検索し、既存の定訳を取得。

- **メリット**: 完全に汎用的、メンテナンス不要
- **デメリット**: 検索API必要、誤検出リスク

### 7. 音訳禁止プロンプト

プロンプトで音訳を禁止し、意味訳を指示。

- **メリット**: 低コスト、即効性
- **デメリット**: AIの知識に依存

### 8. Human-in-the-Loop Feedback

ユーザーの修正を蓄積し、将来の翻訳に反映。

- **メリット**: 実使用に基づく改善
- **デメリット**: 長期的投資、品質管理必要

---

## 採用アプローチ

段階的に導入する。

### Phase 1: プロンプト改善（即時効果）

DB追加やUI追加なしで効果を出す。

- **音訳禁止 + 定訳優先の明示**
  - 「音訳しない」「定訳があれば優先」「なければ意味訳」を全モデル共通で指示
- **原文言語の明示**
  - sourceLocale を明示し、「原文は英語とは限らない」ことを伝える
  - Gemini/Vertex の "English texts" を撤廃

### Phase 2: Translation Memory（既存DB活用）

- 同一セグメント・同一ロケールの既訳がある場合は翻訳対象から除外
- 既訳の上位候補を用語集としてプロンプトに注入
- ジョブ単位で用語集を共有（チャンク間の一貫性）

### Phase 3: 用語抽出の事前パス（LLM）

- タイトル + 冒頭セグメントから固有名詞や訳語候補を抽出
- 抽出結果を `translationContext` に差し込み、翻訳時に固定

### Phase 4: Web検索連携（必要なら）

- 検索APIの導入（キー管理/課金/レート制御）
- `/api/translate` で1回だけ検索し、全チャンクへ共有
- 検索結果パーサーの実装

---

## 現行の制約（2026-01-26 時点）

- **見出し検索は不可**: セグメントに見出し情報が保存されていない
- **Web検索は未統合**: 検索APIが無い
- **translationContext の到達範囲が限定**: 公開時フローのみ
- **Gemini/Vertex のプロンプトが英語前提**: "English texts" という断定文が存在

---

## 実装タスク

### Phase 1
- [ ] Gemini/Vertex プロンプトの英語前提を除去
- [ ] 音訳禁止・定訳優先・意味訳指示を全モデル共通で追加
- [ ] sourceLocale をプロンプトに明示

### Phase 2
- [ ] 既訳の再利用（同一ロケールでの翻訳除外）
- [ ] best translation を用語集としてプロンプトに注入

### Phase 3
- [ ] 用語抽出の事前パス（タイトル + 冒頭セグメント）
- [ ] ジョブ単位で用語集を保存し、全チャンクへ共有

### Phase 4（必要なら）
- [ ] Web検索APIの選定・統合
- [ ] タイトル検索ロジックの実装
- [ ] 検索結果パーサーの実装
- [ ] UI（searchTitle, customTerms）
